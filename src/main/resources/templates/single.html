<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Single</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link th:href="@{~/css/style.css}" rel="stylesheet" type="text/css" media="all"/>
    <link th:href="@{~/css/single.css}" rel="stylesheet" type="text/css" media="all"/>
    <link th:href='@{http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800}' rel='stylesheet'
          type='text/css'>
    <script type="text/javascript" th:src="@{~/js/jquery.min.js}"></script>
    <!-- start menu -->
    <link th:href="@{~/css/megamenu.css}" rel="stylesheet" type="text/css" media="all"/>
    <script type="text/javascript" th:src="@{~/js/megamenu.js}"></script>
    <script>$(document).ready(function () {
        $(".megamenu").megamenu();
    });</script>
    <!-- end menu -->
    <script type="text/javascript" th:src="@{~/js/jquery.jscrollpane.min.js}"></script>
    <script type="text/javascript" id="sourcecode">
        $(function () {
            $('.scroll-pane').jScrollPane();
        });
    </script>
    <!-- top scrolling -->
    <script type="text/javascript" th:src="@{~/js/move-top.js}"></script>
</head>
<body>
<div th:replace="front/common/header::html"></div>

    <div class="inside-box clearfix">
        <dl class="allcake-warp allcake-center inside-dl">
            <dt>
                <!--大图-->
                <ul class="pho-tab js-pho-tab">
                    <li style="display: list-item;"><img style="width:100%;" alt=""  th:src="@{'~/images/'+${cake.img}+'.jpg'}"></li>
                    <li style="display: none;">
                        <img style="width:100%;" alt="" src="http://allcake.oss-cn-hangzhou.aliyuncs.com/system/products/sub_pics/000/000/057/original/_DSC6017_%E5%89%AF%E6%9C%AC.jpg?1453114118">
                    </li>
                    <li style="display: none;">
                        <img style="width:100%;" alt="" src="http://allcake.oss-cn-hangzhou.aliyuncs.com/system/products/pic_thirds/000/000/057/original/_DSC6001_%E5%89%AF%E6%9C%AC.jpg?1453114118">
                    </li>
                </ul>
                <!--缩略图-->
                <ul class="pho-tac js-pho-tac">
                    <li class="pho-cur">
                        <img style="width:100%;" alt="" src="http://allcake.oss-cn-hangzhou.aliyuncs.com/system/products/pics/000/000/057/original/_DSC5987_%E5%89%AF%E6%9C%AC.jpg?1453114118">
                    </li>
                    <li class="">
                        <img style="width:100%;" alt="" src="http://allcake.oss-cn-hangzhou.aliyuncs.com/system/products/sub_pics/000/000/057/original/_DSC6017_%E5%89%AF%E6%9C%AC.jpg?1453114118">
                    </li>
                    <li class="">
                        <img style="width:100%;" alt="" src="http://allcake.oss-cn-hangzhou.aliyuncs.com/system/products/pic_thirds/000/000/057/original/_DSC6001_%E5%89%AF%E6%9C%AC.jpg?1453114118">
                    </li>
                </ul>
                <p class="inside-info">蛋糕在收到后2-3小时内食用最佳，最适宜0℃~8℃冷藏保存，24小时内食用。<br>如对上述食材有过敏经历者，请选择其它款蛋糕。<br>订购1~3磅规格的蛋糕，请提前5小时订购。<br>订购5磅或5磅以上规格的蛋糕，请提前24小时预定或与客服人员联系，订购电话：4009-926-927</p>
            </dt>
            <dd>
                <h5 class="inside-title" th:text="${cake.name}">
                    榴恋
                    <a href="/products?cat_id=2" th:text="${cake.category}">乳脂奶油</a>
                </h5>
                <p class="inside-desc">这一刻未必喜欢，总有一天，无比想念</p>
                <p class="inside-weigth">
                    <a capacity="1磅：约13×13(cm) 适合3-4人食用 " th:id="${cake.id}" th:data-price="${cake.price}" class="product current" href="javascript:void(0)">1磅</a>
                    <a capacity="2磅：约17×17(cm) 适合7-8人食用 " id="250" data-price="268.0" class="product " href="javascript:void(0)">2磅</a>
                    <a capacity="3磅：约23×23(cm) 适合11-12人食用 " id="251" data-price="388.0" class="product " href="javascript:void(0)">3磅</a>
                    <a capacity="5磅：约30×30(cm) 适合15-20人食用 " id="252" data-price="750.0" class="product " href="javascript:void(0)">5磅</a>
                </p>
                <p class="inside-num">
                    <span>数量</span>
                    <input class="jia" onclick="decrement();" type="button">
                    <input id="quantity" class="count" type="text" value="1">
                    <input class="jian" onclick="increment();" type="button">
                </p>
                <p class="inside-tim">需提前5小时预订</p>
                <p class="inside-price">
                    <span id="items_discount_price" th:text="|￥${cake.price}|"><i>￥</i>168.0</span>
                </p>
                <p class="inside-btn">
                    <a class="buynow" id="buy_now" href="javascript:void(0)">立即购买</a>
                    <a class="getchart" id="add_to_cart" href="javascript:void(0)">加入购物车</a>
                </p>
                <table cellpadding="0" cellspacing="0" width="420" border="0" class="inside-table">
                    <tbody><tr>
                        <td align="left" valign="top" width="40">原料</td>
                        <td align="left" valign="top" width="360">榴莲(泰国)、牛奶(新西兰)、巧克力(比利时)</td>
                    </tr>
                    <tr>
                        <td align="left" valign="top" width="40">口味</td>
                        <td align="left" valign="top" width="360">榴莲味浓郁，口感香醇</td>
                    </tr>
                    <tr>
                        <td align="left" valign="top" width="40">甜度</td>
                        <td align="left" valign="top" width="360">
                            <b></b>
                            <b></b>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </dd>
        </dl>
    </div>
    <a href="#" id="toTop" style="display: block;"><span id="toTopHover" style="opacity: 1;"></span></a>
<!--</div>-->
<div th:replace="front/common/footer::html"></div>
</body>
<script type="text/javascript">

    $('#add_to_cart').on('click', function(){
        var id = $('.current').attr('id');
        var quantity = $('#quantity').val();
        $.post('/cake/',
            {
                'id': id,
               'quantity': quantity
             },
            function(data){
                $('#items_count').text(data['items_count']);
            });
    });

    $('#buy_now').on('click', function(){
        var id = $('.current').attr('id');
        var quantity = $('#quantity').val();
        $.post('/order/purchase',
            {
                'id': id,
                'quantity': quantity
            },
            function(data){
                alert(data);
            });
    });

    $('#quantity').on('change', function(){
        sum();
    });

     sum = () => {
        let sku = $('.current');
        let price = parseFloat(sku.data('price'));
        let quantity = parseFloat($('#quantity').val());
        let items_sum_discount_price = (price * quantity).toFixed(1);
        $('#items_discount_price').html('<i>￥</i>'+items_sum_discount_price);
    };
    $('.product').on('click', function(){
        $(".product").removeClass("current");
        $(this).addClass("current");
        sum();
    });
    function increment(e) {
        if (e) {
            var t = $("#quantity" + e);
        } else {
            var t = $("#quantity");
        }
        var n = t.val();
        n < 99 && (n++, t.val(n), e && $.post("/cake/", {item_id: e}, function (t) {
            $(".item_sum" + e).html("\uffe5" + t.item_sum), $(".checkbox" + e).attr("data-sum", t.item_sum), $(".checkbox" + e).attr("originalSum", t.item_originsum), calculate()
        }), t.trigger("change"))
    }

    function calculate() {
        var e = $(".cartListItems .checkboxed"), t = 0, n = 0;
        $.each(e, function (e, i) {
            t += parseFloat($(i).attr("data-sum")), n += parseFloat($(i).attr("originalSum"))
        }), $(".items_total_price").html("\uffe5" + t), $(".items_total_origin_price").html("\u539f\u4ef7" + n + "\u5143"), $(".items_count").html("\u5df2\u9009\u62e9" + e.length + "\u6b3e\u4ea7\u54c1")
    }

    function decrement(e) {
        if (e) var t = $("#quantity" + e); else var t = $("#quantity");
        var n = t.val();
        n > 1 && (n--, t.val(n), e && $.post("/cake/", {item_id: e}, function (t) {
            $(".item_sum" + e).html("\uffe5" + t.item_sum), $(".checkbox" + e).attr("data-sum", t.item_sum), $(".checkbox" + e).attr("originalSum", t.item_originsum), calculate()
        }), t.trigger("change"))
    }

</script>
</html>